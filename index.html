<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Greenshades UTM Builder</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&family=PT+Serif:wght@400;700&display=swap');

    :root {
      --pri-acc-color: rgba(10, 137, 68, 1.0);
      --sec-acc-color: rgba(249, 249, 249, 1.0);
      --source-sans-pro: "Source Sans Pro", sans-serif;
      --pt-serif: "PT Serif", serif;
      --size20: 20px;
      --size21: 21px;
      --size39: 39px;
      --dark-color: #000;
      --white-color: #fff;
      --text-color: #424242;
      --link-color: #85c441;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: #f4f4f6;
      font-family: var(--source-sans-pro);
      color: var(--text-color);
      line-height: 1.5;
    }

    a { color: var(--link-color); }

    header {
      text-align: center;
      padding: 32px 16px 16px;
    }

    .logo {
      display: inline-block;
      margin-bottom: 8px;
    }

    h1 {
      margin: 8px 0 0;
      font-size: var(--size39);
      font-weight: 700;
      color: var(--dark-color);
    }

    main {
      display: flex;
      justify-content: center;
      padding: 0 16px 48px;
    }

    .card {
      background: var(--white-color);
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      max-width: 960px;
      width: 100%;
      padding: 28px;
    }

    .section-title {
      font-size: var(--size21);
      font-weight: 700;
      margin: 16px 0 8px;
      color: var(--dark-color);
    }

    form {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    label {
      font-weight: 600;
      color: var(--dark-color);
    }

    input[type="text"], select, textarea {
      padding: 10px 12px;
      border: 1px solid #dcdcdc;
      border-radius: 8px;
      font-size: 16px;
      font-family: var(--source-sans-pro);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      background: var(--sec-acc-color);
    }

    input[type="text"]:focus, select:focus, textarea:focus {
      outline: 2px solid rgba(10, 137, 68, 0.25);
      border-color: var(--pri-acc-color);
      box-shadow: 0 0 0 2px rgba(10, 137, 68, 0.15);
      background: var(--white-color);
    }

    .helper-text {
      font-size: 13px;
      color: #606060;
    }

    .error-text {
      font-size: 13px;
      color: #c62828;
    }

    .inline-input {
      display: none;
    }

    .inline-input.active {
      display: block;
    }

    .actions {
      grid-column: 1 / -1;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: flex-start;
      margin-top: 4px;
    }

    .btn {
      background: var(--pri-acc-color);
      color: var(--white-color);
      border: none;
      padding: 12px 18px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.2s ease, background 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .btn:not(:disabled):hover {
      background: #0c9553;
      box-shadow: 0 6px 18px rgba(10, 137, 68, 0.28);
    }

    .btn:not(:disabled):active {
      transform: translateY(1px);
    }

    .output-section {
      margin-top: 24px;
      display: grid;
      gap: 12px;
    }

    .output-box {
      background: #f8f9fb;
      border: 1px solid #e6e6e6;
      border-radius: 10px;
      padding: 12px;
      font-family: var(--pt-serif);
      font-size: 15px;
      color: #1f1f1f;
      min-height: 52px;
      word-break: break-all;
    }

    .output-row {
      display: grid;
      gap: 10px;
      grid-template-columns: 1fr auto auto;
      align-items: center;
    }

    .output-row h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 700;
      color: var(--dark-color);
    }

    .output-row .btn {
      padding: 10px 14px;
      font-size: 14px;
      box-shadow: none;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #1b5e20;
      color: var(--white-color);
      padding: 12px 16px;
      border-radius: 8px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.2);
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      pointer-events: none;
      font-weight: 600;
      z-index: 10;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      background: var(--white-color);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
    }

    thead {
      background: #f1f3f5;
    }

    th, td {
      padding: 12px 10px;
      text-align: left;
      font-size: 14px;
      border-bottom: 1px solid #e9ecef;
    }

    th {
      font-weight: 700;
      color: #1d1d1d;
    }

    tbody tr:hover {
      background: #f8fbf8;
    }

    .table-copy-btn {
      background: var(--pri-acc-color);
      color: var(--white-color);
      border: none;
      border-radius: 8px;
      padding: 6px 10px;
      font-size: 13px;
      cursor: pointer;
    }

    .table-copy-btn:hover {
      background: #0c9553;
    }

    .muted {
      color: #6c6c6c;
      font-size: 13px;
    }

    @media (max-width: 720px) {
      .output-row {
        grid-template-columns: 1fr;
      }

      .actions {
        justify-content: center;
      }

      h1 {
        font-size: 28px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo" aria-hidden="true">
      <svg xmlns="http://www.w3.org/2000/svg" width="220" height="32" viewBox="0 0 970.9 136">
        <path d="M69.4,0A68.771,68.771,0,0,1,85.8,1.9a53.012,53.012,0,0,0-5.7.3c-1.2.2-2.5.3-3.7.5-31.3,4.8-55.5,30.8-57,62.7h0v3.4l.1,2.1A49.863,49.863,0,0,0,36.9,106h0l.5.5c.3.2.5.4.8.6a50.189,50.189,0,0,0,31.6,11,54.51,54.51,0,0,0,8.9-.8,45.423,45.423,0,0,0,35.8-37.9h0l.1-.6L56.8,79l17-16.8h60.4l.057.6c.165,1.82.273,3.737.543,5.9h0v.6a67.168,67.168,0,0,1-28.7,55.4h0l-.091.075a2.946,2.946,0,0,0-.309.225h0l-.3.2a62.589,62.589,0,0,1-24.6,9.9,63.507,63.507,0,0,1-10.7.9c-19,0-36.7-7-49.8-19.7A65.02,65.02,0,0,1,.9,78.7a.6.6,0,0,1-.1-.4,28.855,28.855,0,0,1-.4-2.9,3.751,3.751,0,0,1-.1-1A19.419,19.419,0,0,1,.1,72,16.2,16.2,0,0,1,0,69.8V68.6c0-1.1.1-2.2.1-3.2h0v-.7l.011-.59C.14,63.336.22,62.6.3,61.8h0v-.1c.1-1.2.2-2.3.4-3.5C5.8,25.2,34.6,0,69.4,0ZM330.3,44.1c19.3,0,34.8,11.4,41.5,30.5h0l1.7,5-68,25.3.2.4c5.3,10.2,15.7,16.1,28.5,16.1,9.4,0,18.8-4.5,26.5-12.5h0l.4-.5,10.8,10.7-.7.7c-10.7,10.8-22.9,15.9-38.3,15.9-25.7,0-46.9-18.9-48.2-43a47.263,47.263,0,0,1,12.9-35A44.591,44.591,0,0,1,330.3,44.1Zm-95,0c19.3,0,34.8,11.4,41.5,30.5h0l1.7,5-68,25.3.2.4c5.3,10.2,15.7,16.1,28.5,16.1,9.4,0,18.9-4.5,26.5-12.5h0l.4-.5,10.8,10.7-.7.7c-10.7,10.8-22.9,15.9-38.3,15.9-25.7,0-46.9-18.9-48.2-43a47.263,47.263,0,0,1,12.9-35A44.591,44.591,0,0,1,235.3,44.1Zm631.5,0c19.3,0,34.8,11.4,41.5,30.5h0l1.6,4.9-68,25.3.2.4c5.3,10.2,15.7,16.1,28.5,16.1,9.4,0,18.8-4.4,26.6-12.4h0l.4-.5,10.8,10.7-.7.7c-10.7,10.8-22.9,15.9-38.3,15.9-25.7,0-46.9-18.9-48.2-43a47.263,47.263,0,0,1,12.9-35A44.591,44.591,0,0,1,866.8,44.1Zm-209.4,1a45,45,0,0,1,33.1,14.1h0l.7.8V48.4h16.7v83.1h-16V119.2l-.7.8a45.387,45.387,0,0,1-33.8,14.6c-24.5,0-43.6-19.6-43.6-44.6C613.8,65.2,633.4,45.1,657.4,45.1Zm154-43.8V131.4h-16V119.3l-.7.8c-8.3,9.2-20.6,14.5-33.8,14.5-24.5,0-43.6-19.6-43.6-44.6,0-24.8,19.6-44.9,43.6-44.9A44.837,44.837,0,0,1,794,59.2h0l.7.8V7.5ZM493.7,45.6a47.659,47.659,0,0,1,18.4,4.1,22.558,22.558,0,0,1,6.7,4.5h0l.7.7-9.7,9.4-.6-.3a31.233,31.233,0,0,0-14.3-4.1c-6.8,0-11.6,3.2-11.6,7.8,0,4.1,4.1,7,14.1,13.2,2.7,1.7,5.1,3.4,7.3,4.9,13,9.2,17.2,14.8,17.2,23,0,14.9-12.2,25-30.3,25.1-8.7,0-18.4-2.9-27.3-8.1h0l-1.1-.6,10.7-10.5.6.3c6.4,3.2,10.8,4.5,15.1,4.5,10.8-.3,14.7-5.2,14.7-9.4,0-2.4-1.4-5.8-11.2-12.6-1.7-1.2-3.5-2.4-5.5-3.6C469.8,82.7,465.9,78,465.9,67.5a20.452,20.452,0,0,1,6.3-14.4c3.5-3.4,10-7.5,21.2-7.5h.3Zm449,0a47.659,47.659,0,0,1,18.4,4.1,20.806,20.806,0,0,1,6.7,4.5h0l.7.7-8.9,8.7v1.2l-1.5-.8a31.232,31.232,0,0,0-14.3-4.1c-6.8,0-11.6,3.2-11.6,7.8,0,4.1,4.1,7,14.1,13.2,2.6,1.7,5,3.3,7.3,4.9,13,9.2,17.2,14.8,17.3,23,0,14.9-12.2,25-30.3,25.1-8.7,0-18.4-2.9-27.3-8.1h0l-1.1-.6,10.7-10.5.6.3c6.4,3.2,10.8,4.5,15.1,4.5,10.8-.3,14.7-5.2,14.7-9.4,0-2.4-1.4-5.8-11.2-12.6-1.7-1.2-3.5-2.3-5.5-3.6C918.8,82.7,914.9,78,914.9,67.5a20.452,20.452,0,0,1,6.3-14.4c3.5-3.4,10-7.5,21.2-7.5h.3Zm-517,.5C444.4,46.1,456,57.9,456,77h0v54.4H439.3v-48c0-7.8-2.5-21-19.7-21-8.2,0-20.3,6.2-20.3,19.6h0v49.4H382.6V48.3h16.1v7.6l.7-.7C407,47.7,417.9,46.1,425.7,46.1ZM547.2,1.3V55.9l.7-.7c7.6-7.5,18.5-9.1,26.3-9.1,18.8,0,30.5,11.8,30.5,30.9h0v54.4H588v-48c0-7.8-2.6-21-19.9-21-8.2,0-20.3,6.2-20.3,19.6h0v49.4H531.1V7.3ZM187.4,48.1V63.7c-16.1.2-25.7,11.3-25.7,22h0v45.6H145V48.2h16.1V61.9l.7-1.1c5.1-6.5,11.7-12.6,25.6-12.7ZM660.2,60.8a28.577,28.577,0,0,0-28.8,28.9c0,16.3,12.6,29.1,28.8,29.1a29,29,0,1,0,0-58Zm103.6,0A28.577,28.577,0,0,0,735,89.7c0,16.3,12.6,29.1,28.8,29.1a29,29,0,1,0,0-58ZM330.5,58.4a26.761,26.761,0,0,0-19.3,8.4c-6,6.2-9.1,14.9-8.9,24.5h0v.6l50.8-19.2.4-.2-.2-.4C348.3,63.1,340.4,58.4,330.5,58.4Zm-95,0a26.761,26.761,0,0,0-19.3,8.4c-6,6.2-9.1,14.9-8.9,24.5h0v.6l50.8-19.2.4-.2-.2-.4C253.3,63.1,245.4,58.4,235.5,58.4Zm631.5,0a26.761,26.761,0,0,0-19.3,8.4c-6,6.2-9.1,14.9-8.9,24.5h0v.6l50.8-19.2.4-.2-.2-.4C884.8,63.1,876.9,58.4,867,58.4Z" fill="#062a47"></path>
        <path d="M99.2,11.2A61.036,61.036,0,0,0,81.1,8.5,60.415,60.415,0,0,0,25.7,44.1l.9-1.5.2-.3c.3-.5.7-1,1-1.5.3-.4.5-.7.8-1.1l.5-.6h0a49.6,49.6,0,0,1,16.5-13c18.3-9.3,41.7-5.7,56,8.9l15.2-15.1a61.481,61.481,0,0,0-17.6-8.7" fill="#85c441"></path>
      </svg>
    </div>
    <h1>Greenshades UTM Builder</h1>
  </header>

  <main>
    <div class="card">
      <div class="section-title">Campaign Parameters</div>
      <form id="utm-form" novalidate>
        <div class="form-group" style="grid-column: 1 / -1;">
          <label for="base-url">Base URL <span aria-hidden="true" style="color:#c62828;">*</span></label>
          <input type="text" id="base-url" placeholder="https://www.greenshades.com/pricing" required aria-describedby="base-url-error">
          <div id="base-url-error" class="error-text" role="alert" aria-live="polite"></div>
        </div>

        <div class="form-group">
          <label for="campaign-name">Campaign Name (utm_campaign) <span aria-hidden="true" style="color:#c62828;">*</span></label>
          <input type="text" id="campaign-name" placeholder="q3_product_launch" required>
          <div class="helper-text">Ex: q3_product_launch, year_end_promo</div>
        </div>

        <div class="form-group">
          <label for="source-select">Source (utm_source) <span aria-hidden="true" style="color:#c62828;">*</span></label>
          <select id="source-select" required>
            <option value="">Select source</option>
            <option value="google">google</option>
            <option value="linkedin">linkedin</option>
            <option value="facebook">facebook</option>
            <option value="email">email</option>
            <option value="newsletter">newsletter</option>
            <option value="webinar">webinar</option>
            <option value="trade_show">trade_show</option>
            <option value="referral">referral</option>
            <option value="custom">Custom</option>
          </select>
          <input type="text" id="custom-source" class="inline-input" placeholder="Enter custom source">
        </div>

        <div class="form-group">
          <label for="medium-select">Medium (utm_medium) <span aria-hidden="true" style="color:#c62828;">*</span></label>
          <select id="medium-select" required>
            <option value="">Select medium</option>
            <option value="cpc">cpc</option>
            <option value="paid_social">paid_social</option>
            <option value="email">email</option>
            <option value="organic_social">organic_social</option>
            <option value="display">display</option>
            <option value="partner">partner</option>
            <option value="other">other</option>
          </select>
          <input type="text" id="custom-medium" class="inline-input" placeholder="Enter custom medium">
        </div>

        <div class="form-group">
          <label for="content">Content (utm_content)</label>
          <input type="text" id="content" placeholder="variant_a">
          <div class="helper-text">Used to differentiate ad variations or placements.</div>
        </div>

        <div class="form-group">
          <label for="term">Term (utm_term)</label>
          <input type="text" id="term" placeholder="keyword">
          <div class="helper-text">Optional. Often used for paid search keywords.</div>
        </div>

        <div class="form-group">
          <label for="asset">Asset Name / Notes (internal)</label>
          <input type="text" id="asset" placeholder="Hero banner A/B test" aria-describedby="asset-helper">
          <div class="helper-text" id="asset-helper">Not included in URL. Shown in history for context.</div>
        </div>

        <div class="actions">
          <button id="generate-btn" class="btn" type="button" disabled>Generate UTM URL</button>
          <div class="muted">Required fields: Base URL, Campaign, Source, Medium.</div>
        </div>
      </form>

      <div class="section-title">Output</div>
      <div class="output-section">
        <div class="output-row">
          <div>
            <h3>UTM Query String</h3>
            <div id="query-output" class="output-box" aria-live="polite">?utm_source=&utm_medium=&utm_campaign=</div>
          </div>
          <button id="copy-query" class="btn" type="button">Copy Query String</button>
          <span id="query-status" class="muted" aria-live="polite"></span>
        </div>

        <div class="output-row">
          <div>
            <h3>Full URL</h3>
            <div id="full-output" class="output-box" aria-live="polite">https://www.greenshades.com/pricing?utm_source=&utm_medium=&utm_campaign=</div>
          </div>
          <button id="copy-full" class="btn" type="button">Copy Full URL</button>
          <span id="full-status" class="muted" aria-live="polite"></span>
        </div>
      </div>

      <div class="section-title">Recently Generated Links</div>
      <table aria-label="Recently generated UTM links">
        <thead>
          <tr>
            <th scope="col">Time</th>
            <th scope="col">Asset</th>
            <th scope="col">Source</th>
            <th scope="col">Medium</th>
            <th scope="col">Campaign</th>
            <th scope="col">Full URL</th>
            <th scope="col">Copy</th>
          </tr>
        </thead>
        <tbody id="history-body">
          <tr><td class="muted" colspan="7">No links generated yet.</td></tr>
        </tbody>
      </table>
    </div>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite">Copied!</div>

  <script>
    const baseUrlInput = document.getElementById('base-url');
    const campaignInput = document.getElementById('campaign-name');
    const sourceSelect = document.getElementById('source-select');
    const customSourceInput = document.getElementById('custom-source');
    const mediumSelect = document.getElementById('medium-select');
    const customMediumInput = document.getElementById('custom-medium');
    const contentInput = document.getElementById('content');
    const termInput = document.getElementById('term');
    const assetInput = document.getElementById('asset');
    const generateBtn = document.getElementById('generate-btn');
    const queryOutput = document.getElementById('query-output');
    const fullOutput = document.getElementById('full-output');
    const queryStatus = document.getElementById('query-status');
    const fullStatus = document.getElementById('full-status');
    const baseUrlError = document.getElementById('base-url-error');
    const historyBody = document.getElementById('history-body');
    const toast = document.getElementById('toast');

    let history = [];
    let toastTimeout;

    function normalizeValue(value) {
      if (!value) return '';
      const trimmed = value.trim().toLowerCase().replace(/\s+/g, '_');
      return encodeURIComponent(trimmed);
    }

    function isValidUrl(value) {
      if (!value) return false;
      const trimmed = value.trim();
      const pattern = /^https?:\/\//i;
      if (!pattern.test(trimmed)) return false;
      try {
        new URL(trimmed);
        return true;
      } catch {
        return false;
      }
    }

    function currentValues() {
      const sourceValue = sourceSelect.value === 'custom' ? customSourceInput.value : sourceSelect.value;
      const mediumValue = mediumSelect.value === 'other' ? customMediumInput.value : mediumSelect.value;

      return {
        baseUrl: baseUrlInput.value.trim(),
        campaign: campaignInput.value,
        source: sourceValue,
        medium: mediumValue,
        content: contentInput.value,
        term: termInput.value,
        asset: assetInput.value
      };
    }

    function buildQuery(params) {
      const queryParts = [];
      if (params.source) queryParts.push(['utm_source', normalizeValue(params.source)]);
      if (params.medium) queryParts.push(['utm_medium', normalizeValue(params.medium)]);
      if (params.campaign) queryParts.push(['utm_campaign', normalizeValue(params.campaign)]);
      if (params.content) queryParts.push(['utm_content', normalizeValue(params.content)]);
      if (params.term) queryParts.push(['utm_term', normalizeValue(params.term)]);

      if (!queryParts.length) return '';

      const searchParams = new URLSearchParams();
      queryParts.forEach(([key, val]) => {
        if (val) searchParams.append(key, val);
      });
      const qs = searchParams.toString();
      return qs ? `?${qs}` : '';
    }

    function buildFullUrl(base, queryString) {
      if (!base) return '';
      const hasQuery = base.includes('?');
      if (!queryString) return base;
      if (hasQuery) {
        return base.endsWith('&') || base.endsWith('?') ? `${base}${queryString.replace(/^\?/, '')}` : `${base}&${queryString.replace(/^\?/, '')}`;
      }
      return `${base}${queryString}`;
    }

    function updateInlineVisibility() {
      customSourceInput.classList.toggle('active', sourceSelect.value === 'custom');
      customMediumInput.classList.toggle('active', mediumSelect.value === 'other');
    }

    function truncateMiddle(str, max = 60) {
      if (str.length <= max) return str;
      const start = str.slice(0, Math.floor(max / 2) - 2);
      const end = str.slice(-Math.floor(max / 2) + 1);
      return `${start}...${end}`;
    }

    function validateBase() {
      const value = baseUrlInput.value.trim();
      if (!value) {
        baseUrlError.textContent = '';
        return false;
      }
      const valid = isValidUrl(value);
      baseUrlError.textContent = valid ? '' : 'Please enter a valid URL that starts with http or https.';
      return valid;
    }

    function requiredFieldsFilled() {
      const { baseUrl, campaign, source, medium } = currentValues();
      return baseUrl && campaign.trim() && source.trim() && medium.trim();
    }

    function updateOutputs() {
      const params = currentValues();
      const baseValid = validateBase();
      const ready = baseValid && requiredFieldsFilled();
      generateBtn.disabled = !ready;

      if (!ready) {
        queryOutput.textContent = '?utm_source=&utm_medium=&utm_campaign=';
        fullOutput.textContent = params.baseUrl || 'https://www.greenshades.com/pricing?utm_source=&utm_medium=&utm_campaign=';
        return;
      }

      const query = buildQuery(params);
      const full = buildFullUrl(params.baseUrl, query);
      queryOutput.textContent = query || '?';
      fullOutput.textContent = full;
    }

    function showToast(message) {
      toast.textContent = message;
      toast.classList.add('show');
      clearTimeout(toastTimeout);
      toastTimeout = setTimeout(() => toast.classList.remove('show'), 2000);
    }

    async function copyToClipboard(text, statusElement) {
      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(text);
        } else {
          const tempInput = document.createElement('textarea');
          tempInput.value = text;
          document.body.appendChild(tempInput);
          tempInput.select();
          document.execCommand('copy');
          document.body.removeChild(tempInput);
        }
        statusElement.textContent = 'Copied!';
        showToast('Copied!');
        setTimeout(() => statusElement.textContent = '', 1500);
      } catch (err) {
        statusElement.textContent = 'Copy failed';
        setTimeout(() => statusElement.textContent = '', 2000);
      }
    }

    function addToHistory(params, fullUrl) {
      const now = new Date();
      const timestamp = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
      const normalized = {
        source: normalizeValue(params.source),
        medium: normalizeValue(params.medium),
        campaign: normalizeValue(params.campaign)
      };

      const entry = {
        time: timestamp,
        asset: params.asset.trim() || '-',
        source: normalized.source,
        medium: normalized.medium,
        campaign: normalized.campaign,
        url: fullUrl
      };

      history.unshift(entry);
      renderHistory();
    }

    function renderHistory() {
      historyBody.innerHTML = '';
      if (!history.length) {
        const row = document.createElement('tr');
        const cell = document.createElement('td');
        cell.colSpan = 7;
        cell.className = 'muted';
        cell.textContent = 'No links generated yet.';
        row.appendChild(cell);
        historyBody.appendChild(row);
        return;
      }

      history.forEach((item, idx) => {
        const row = document.createElement('tr');

        const timeCell = document.createElement('td');
        timeCell.textContent = item.time;
        row.appendChild(timeCell);

        const assetCell = document.createElement('td');
        assetCell.textContent = item.asset;
        row.appendChild(assetCell);

        const sourceCell = document.createElement('td');
        sourceCell.textContent = item.source;
        row.appendChild(sourceCell);

        const mediumCell = document.createElement('td');
        mediumCell.textContent = item.medium;
        row.appendChild(mediumCell);

        const campaignCell = document.createElement('td');
        campaignCell.textContent = item.campaign;
        row.appendChild(campaignCell);

        const urlCell = document.createElement('td');
        urlCell.title = item.url;
        urlCell.textContent = truncateMiddle(item.url, 80);
        row.appendChild(urlCell);

        const copyCell = document.createElement('td');
        const copyBtn = document.createElement('button');
        copyBtn.type = 'button';
        copyBtn.className = 'table-copy-btn';
        copyBtn.textContent = 'Copy';
        copyBtn.addEventListener('click', () => copyToClipboard(item.url, fullStatus));
        copyCell.appendChild(copyBtn);
        row.appendChild(copyCell);

        historyBody.appendChild(row);
      });
    }

    function handleGenerate() {
      const params = currentValues();
      const baseValid = validateBase();
      if (!(baseValid && requiredFieldsFilled())) return;

      const query = buildQuery(params);
      const full = buildFullUrl(params.baseUrl, query);
      queryOutput.textContent = query || '?';
      fullOutput.textContent = full;
      addToHistory(params, full);
    }

    const inputs = [baseUrlInput, campaignInput, sourceSelect, customSourceInput, mediumSelect, customMediumInput, contentInput, termInput, assetInput];
    inputs.forEach(input => input.addEventListener('input', () => {
      updateInlineVisibility();
      updateOutputs();
    }));

    sourceSelect.addEventListener('change', () => {
      if (sourceSelect.value !== 'custom') customSourceInput.value = '';
      updateInlineVisibility();
      updateOutputs();
    });

    mediumSelect.addEventListener('change', () => {
      if (mediumSelect.value !== 'other') customMediumInput.value = '';
      updateInlineVisibility();
      updateOutputs();
    });

    generateBtn.addEventListener('click', handleGenerate);

    document.getElementById('copy-full').addEventListener('click', () => {
      copyToClipboard(fullOutput.textContent, fullStatus);
    });

    document.getElementById('copy-query').addEventListener('click', () => {
      copyToClipboard(queryOutput.textContent, queryStatus);
    });

    updateInlineVisibility();
    updateOutputs();
  </script>
</body>
</html>
