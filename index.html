<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Greenshades UTM Builder</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&family=PT+Serif:wght@400;700&display=swap');

    :root {
      --pri-acc-color: rgba(10, 137, 68, 1.0);
      --sec-acc-color: rgba(249, 249, 249, 1.0);
      --source-sans-pro: "Source Sans Pro", sans-serif;
      --pt-serif: "PT Serif", serif;
      --size20: 20px;
      --size21: 21px;
      --size39: 39px;
      --dark-color: #000;
      --white-color: #fff;
      --text-color: #424242;
      --link-color: #85c441;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: var(--source-sans-pro);
      color: #f5f5f5;
      line-height: 1.5;
      background-color: #1b1b1b;
      transition: background-color 0.25s ease, color 0.25s ease;
    }

    body[data-theme="light"] {
      background-color: #f5f5f5;
      color: var(--text-color);
    }

    a { color: var(--link-color); }

    .page-shell {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 48px;
    }

    .page-header {
      max-width: 1200px;
      margin: 0 auto 12px;
      padding: 0 4px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .logo {
      display: inline-block;
      margin-bottom: 0;
      width: 220px;
      height: 32px;
    }

    .logo-mark {
      display: inline-block;
    }

    .logo-dark {
      display: none;
    }

    body[data-theme="light"] .logo-light {
      display: inline-block;
    }

    body[data-theme="light"] .logo-dark {
      display: none;
    }

    body[data-theme="dark"] .logo-light {
      display: none;
    }

    body[data-theme="dark"] .logo-dark {
      display: inline-block;
    }

    h1 {
      margin: 6px 0 0;
      font-size: var(--size39);
      font-weight: 700;
      color: inherit;
    }

    .theme-toggle {
      position: relative;
      width: 46px;
      height: 26px;
      border-radius: 999px;
      border: none;
      padding: 3px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: flex-start;
      background: #cbd5f5;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.25);
      transition: background-color 0.18s ease-out, box-shadow 0.18s ease-out, transform 0.12s ease-out;
    }

    .theme-toggle:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.35);
    }

    .theme-toggle:focus-visible {
      outline: 2px solid var(--link-color);
      outline-offset: 3px;
    }

    .theme-toggle-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.35);
      transform: translateX(0);
      transition: transform 0.18s ease-out, background-color 0.18s ease-out, color 0.18s ease-out;
    }

    .theme-toggle-icon {
      font-size: 13px;
    }

    body[data-theme="dark"] .theme-toggle-thumb {
      background-color: #000000;
      color: #ffffff;
    }

    body[data-theme="dark"] .theme-toggle {
      background-color: #d0d4f0;
    }

    body[data-theme="light"] .theme-toggle {
      background-color: var(--pri-acc-color);
    }

    body[data-theme="light"] .theme-toggle-thumb {
      background-color: #ffffff;
      color: #000000;
      transform: translateX(18px);
    }

    .card {
      background: #232323;
      border-radius: 14px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6);
      max-width: 1200px;
      width: 100%;
      padding: 28px;
      color: #f5f5f5;
      overflow: hidden;
      transition: background-color 0.25s ease, box-shadow 0.25s ease, color 0.25s ease;
    }

    body[data-theme="light"] .card {
      background: #ffffff;
      color: var(--text-color);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }

    .section-title {
      font-size: var(--size21);
      font-weight: 700;
      margin: 16px 0 8px;
      color: inherit;
    }

    form {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    label {
      font-weight: 600;
      color: inherit;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    input[type="text"], select, textarea {
      padding: 10px 12px;
      border: 1px solid #444;
      border-radius: 8px;
      font-size: 16px;
      font-family: var(--source-sans-pro);
      transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease, color 0.2s ease;
      background: #2b2b2b;
      color: #f5f5f5;
    }

    input[type="text"]:focus, select:focus, textarea:focus {
      outline: 2px solid rgba(10, 137, 68, 0.25);
      border-color: var(--pri-acc-color);
      box-shadow: 0 0 0 2px rgba(10, 137, 68, 0.15);
      background: #2f2f2f;
    }

    body[data-theme="light"] input[type="text"],
    body[data-theme="light"] select,
    body[data-theme="light"] textarea {
      background: #fff;
      border-color: #ccc;
      color: #000;
    }

    body[data-theme="light"] input[type="text"]:focus,
    body[data-theme="light"] select:focus,
    body[data-theme="light"] textarea:focus {
      background: #fff;
    }

    .helper-text {
      font-size: 13px;
      color: #b0b0b0;
    }

    body[data-theme="light"] .helper-text {
      color: #606060;
    }

    .error-text {
      font-size: 13px;
      color: #c62828;
    }

    .inline-input {
      display: none;
    }

    .inline-input.active {
      display: block;
    }

    .actions {
      grid-column: 1 / -1;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: flex-start;
      margin-top: 4px;
    }

    .btn {
      background: var(--pri-acc-color);
      color: var(--white-color);
      border: none;
      padding: 12px 18px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.2s ease, background 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .btn:not(:disabled):hover {
      background: #0c9553;
      box-shadow: 0 6px 18px rgba(10, 137, 68, 0.28);
    }

    .btn:not(:disabled):active {
      transform: translateY(1px);
    }

    .output-section {
      margin-top: 24px;
      display: grid;
      gap: 12px;
    }

    .output-box {
      background: #2b2b2b;
      border: 1px solid #444;
      border-radius: 10px;
      padding: 12px;
      font-family: var(--pt-serif);
      font-size: 15px;
      color: #f5f5f5;
      min-height: 52px;
      word-break: break-all;
      transition: background-color 0.25s ease, border-color 0.25s ease, color 0.25s ease;
    }

    body[data-theme="light"] .output-box {
      background: #f8f9fb;
      border-color: #e6e6e6;
      color: #1f1f1f;
    }

    .output-row {
      display: grid;
      gap: 10px;
      grid-template-columns: 1fr auto auto;
      align-items: center;
    }

    .output-row h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 700;
      color: inherit;
    }

    .output-row .btn {
      padding: 10px 14px;
      font-size: 14px;
      box-shadow: none;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #1b5e20;
      color: var(--white-color);
      padding: 12px 16px;
      border-radius: 8px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.2);
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      pointer-events: none;
      font-weight: 600;
      z-index: 10;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    .history-wrapper {
      width: 100%;
      overflow-x: auto;
    }

    .history-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      background: #232323;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
      color: inherit;
      transition: background-color 0.25s ease, box-shadow 0.25s ease, color 0.25s ease;
      table-layout: fixed;
      font-size: 12px;
    }

    /* Column widths: Time (narrow), URL (wide), Copy (narrow) */
    .history-table th:nth-child(1),
    .history-table td:nth-child(1) {
      width: 18%;
    }

    .history-table th:nth-child(2),
    .history-table td:nth-child(2) {
      width: 67%;
    }

    .history-table th:nth-child(3),
    .history-table td:nth-child(3) {
      width: 15%;
    }

    .history-table thead {
      background: #2e2e2e;
    }

    .history-table th,
    .history-table td {
      padding: 6px 8px;
      text-align: left;
      font-size: 12px;
      border-bottom: 1px solid #3a3a3a;
      color: inherit;
      vertical-align: top;
      word-wrap: break-word;
      word-break: break-word;
    }

    .history-table th {
      font-weight: 700;
    }

    .history-table tbody tr:hover {
      background: #2c2c2c;
    }

    .history-table td:last-child,
    .history-table th:last-child {
      text-align: right;
      white-space: nowrap;
    }

    .history-url {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }

    body[data-theme="light"] .history-table {
      background: #ffffff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    body[data-theme="light"] .history-table thead {
      background: #f1f3f5;
    }

    body[data-theme="light"] .history-table th,
    body[data-theme="light"] .history-table td {
      border-bottom-color: #e9ecef;
      color: var(--text-color);
    }

    body[data-theme="light"] .history-table tbody tr:hover {
      background: #f8fbf8;
    }

    .table-copy-btn {
      background: var(--pri-acc-color);
      color: var(--white-color);
      border: none;
      border-radius: 8px;
      padding: 6px 10px;
      font-size: 13px;
      cursor: pointer;
    }

    .table-copy-btn:hover {
      background: #0c9553;
    }

    .muted {
      color: #b0b0b0;
      font-size: 13px;
    }

    body[data-theme="light"] .muted {
      color: #6c6c6c;
    }

    .info {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      color: inherit;
      font-size: 12px;
      cursor: help;
      position: relative;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    body[data-theme="light"] .info {
      background: rgba(0, 0, 0, 0.05);
      border-color: rgba(0, 0, 0, 0.12);
    }

    .info .tooltip {
      visibility: hidden;
      opacity: 0;
      position: absolute;
      bottom: 130%;
      left: 50%;
      transform: translateX(-50%);
      background: #111;
      color: #f5f5f5;
      padding: 8px 10px;
      border-radius: 8px;
      font-size: 12px;
      line-height: 1.4;
      width: 240px;
      max-width: 260px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
      transition: opacity 0.2s ease, visibility 0.2s ease;
      z-index: 5;
    }

    .info .tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border-width: 6px;
      border-style: solid;
      border-color: #111 transparent transparent transparent;
    }

    body[data-theme="light"] .info .tooltip {
      background: #000;
      color: #fff;
    }

    .info:hover .tooltip,
    .info:focus-visible .tooltip,
    .info:focus .tooltip {
      visibility: visible;
      opacity: 1;
    }

    @media (max-width: 720px) {
      .output-row {
        grid-template-columns: 1fr;
      }

      .actions {
        justify-content: center;
      }

      h1 {
        font-size: 28px;
      }
    }

    @media (max-width: 480px) {
      .page-header {
        flex-wrap: wrap;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body data-theme="dark">
  <div class="page-shell">
    <header class="page-header">
      <div>
        <div class="logo logo-wrap" aria-hidden="true">
          <div class="logo-mark logo-light">
            <!-- LIGHT MODE LOGO: EXACTLY AS PROVIDED. DO NOT CHANGE ANYTHING IN THIS SVG. -->
            <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 970.9 136">              <path d="M69.4,0A68.771,68.771,0,0,1,85.8,1.9a53.012,53.012,0,0,0-5.7.3c-1.2.2-2.5.3-3.7.5-31.3,4.8-55.5,30.8-57,62.7h0v3.4l.1,2.1A49.863,49.863,0,0,0,36.9,106h0l.5.5c.3.2.5.4.8.6a50.189,50.189,0,0,0,31.6,11,54.51,54.51,0,0,0,8.9-.8,45.423,45.423,0,0,0,35.8-37.9h0l.1-.6L56.8,79l17-16.8h60.4l.057.6c.165,1.82.273,3.737.543,5.9h0v.6a67.168,67.168,0,0,1-28.7,55.4h0l-.091.075a2.946,2.946,0,0,0-.309.225h0l-.3.2a62.589,62.589,0,0,1-24.6,9.9,63.507,63.507,0,0,1-10.7.9c-19,0-36.7-7-49.8-19.7A65.02,65.02,0,0,1,.9,78.7a.6.6,0,0,1-.1-.4,28.855,28.855,0,0,1-.4-2.9,3.751,3.751,0,0,1-.1-1A19.419,19.419,0,0,1,.1,72,16.2,16.2,0,0,1,0,69.8V68.6c0-1.1.1-2.2.1-3.2h0v-.7l.011-.59C.14,63.336.22,62.6.3,61.8h0v-.1c.1-1.2.2-2.3.4-3.5C5.8,25.2,34.6,0,69.4,0ZM330.3,44.1c19.3,0,34.8,11.4,41.5,30.5h0l1.7,5-68,25.3.2.4c5.3,10.2,15.7,16.1,28.5,16.1,9.4,0,18.8-4.5,26.5-12.5h0l.4-.5,10.8,10.7-.7.7c-10.7,10.8-22.9,15.9-38.3,15.9-25.7,0-46.9-18.9-48.2-43a47.263,47.263,0,0,1,12.9-35A44.591,44.591,0,0,1,330.3,44.1Zm-95,0c19.3,0,34.8,11.4,41.5,30.5h0l1.7,5-68,25.3.2.4c5.3,10.2,15.7,16.1,28.5,16.1,9.4,0,18.9-4.5,26.5-12.5h0l.4-.5,10.8,10.7-.7.7c-10.7,10.8-22.9,15.9-38.3,15.9-25.7,0-46.9-18.9-48.2-43a47.263,47.263,0,0,1,12.9-35A44.591,44.591,0,0,1,235.3,44.1Zm631.5,0c19.3,0,34.8,11.4,41.5,30.5h0l1.6,4.9-68,25.3.2.4c5.3,10.2,15.7,16.1,28.5,16.1,9.4,0,18.8-4.4,26.6-12.4h0l.4-.5,10.8,10.7-.7.7c-10.7,10.8-22.9,15.9-38.3,15.9-25.7,0-46.9-18.9-48.2-43a47.263,47.263,0,0,1,12.9-35A44.591,44.591,0,0,1,866.8,44.1Zm-209.4,1a45,45,0,0,1,33.1,14.1h0l.7.8V48.4h16.7v83.1h-16V119.2l-.7.8a45.387,45.387,0,0,1-33.8,14.6c-24.5,0-43.6-19.6-43.6-44.6C613.8,65.2,633.4,45.1,657.4,45.1Zm154-43.8V131.4h-16V119.3l-.7.8c-8.3,9.2-20.6,14.5-33.8,14.5-24.5,0-43.6-19.6-43.6-44.6,0-24.8,19.6-44.9,43.6-44.9A44.837,44.837,0,0,1,794,59.2h0l.7.8V7.5ZM493.7,45.6a47.659,47.659,0,0,1,18.4,4.1,22.558,22.558,0,0,1,6.7,4.5h0l.7.7-9.7,9.4-.6-.3a31.233,31.233,0,0,0-14.3-4.1c-6.8,0-11.6,3.2-11.6,7.8,0,4.1,4.1,7,14.1,13.2,2.7,1.7,5.1,3.4,7.3,4.9,13,9.2,17.2,14.8,17.2,23,0,14.9-12.2,25-30.3,25.1-8.7,0-18.4-2.9-27.3-8.1h0l-1.1-.6,10.7-10.5.6.3c6.4,3.2,10.8,4.5,15.1,4.5,10.8-.3,14.7-5.2,14.7-9.4,0-2.4-1.4-5.8-11.2-12.6-1.7-1.2-3.5-2.4-5.5-3.6C469.8,82.7,465.9,78,465.9,67.5a20.452,20.452,0,0,1,6.3-14.4c3.5-3.4,10-7.5,21.2-7.5h.3Zm449,0a47.659,47.659,0,0,1,18.4,4.1,20.806,20.806,0,0,1,6.7,4.5h0l.7.7-8.9,8.7v1.2l-1.5-.8a31.232,31.232,0,0,0-14.3-4.1c-6.8,0-11.6,3.2-11.6,7.8,0,4.1,4.1,7,14.1,13.2,2.6,1.7,5,3.3,7.3,4.9,13,9.2,17.2,14.8,17.3,23,0,14.9-12.2,25-30.3,25.1-8.7,0-18.4-2.9-27.3-8.1h0l-1.1-.6,10.7-10.5.6.3c6.4,3.2,10.8,4.5,15.1,4.5,10.8-.3,14.7-5.2,14.7-9.4,0-2.4-1.4-5.8-11.2-12.6-1.7-1.2-3.5-2.3-5.5-3.6C918.8,82.7,914.9,78,914.9,67.5a20.452,20.452,0,0,1,6.3-14.4c3.5-3.4,10-7.5,21.2-7.5h.3Zm-517,.5C444.4,46.1,456,57.9,456,77h0v54.4H439.3v-48c0-7.8-2.5-21-19.7-21-8.2,0-20.3,6.2-20.3,19.6h0v49.4H382.6V48.3h16.1v7.6l.7-.7C407,47.7,417.9,46.1,425.7,46.1ZM547.2,1.3V55.9l.7-.7c7.6-7.5,18.5-9.1,26.3-9.1,18.8,0,30.5,11.8,30.5,30.9h0v54.4H588v-48c0-7.8-2.6-21-19.9-21-8.2,0-20.3,6.2-20.3,19.6h0v49.4H531.1V7.3ZM187.4,48.1V63.7c-16.1.2-25.7,11.3-25.7,22h0v45.6H145V48.2h16.1V61.9l.7-1.1c5.1-6.5,11.7-12.6,25.6-12.7ZM660.2,60.8a28.577,28.577,0,0,0-28.8,28.9c0,16.3,12.6,29.1,28.8,29.1a29,29,0,1,0,0-58Zm103.6,0A28.577,28.577,0,0,0,735,89.7c0,16.3,12.6,29.1,28.8,29.1a29,29,0,1,0,0-58ZM330.5,58.4a26.761,26.761,0,0,0-19.3,8.4c-6,6.2-9.1,14.9-8.9,24.5h0v.6l50.8-19.2.4-.2-.2-.4C348.3,63.1,340.4,58.4,330.5,58.4Zm-95,0a26.761,26.761,0,0,0-19.3,8.4c-6,6.2-9.1,14.9-8.9,24.5h0v.6l50.8-19.2.4-.2-.2-.4C253.3,63.1,245.4,58.4,235.5,58.4Zm631.5,0a26.761,26.761,0,0,0-19.3,8.4c-6,6.2-9.1,14.9-8.9,24.5h0v.6l50.8-19.2.4-.2-.2-.4C884.8,63.1,876.9,58.4,867,58.4Z" fill="#062a47"></path>              <path d="M99.2,11.2A61.036,61.036,0,0,0,81.1,8.5,60.415,60.415,0,0,0,25.7,44.1l.9-1.5.2-.3c.3-.5.7-1,1-1.5.3-.4.5-.7.8-1.1l.5-.6h0a49.6,49.6,0,0,1,16.5-13c18.3-9.3,41.7-5.7,56,8.9l15.2-15.1a61.481,61.481,0,0,0-17.6-8.7" fill="#85c441"></path>            </svg>
          </div>

          <div class="logo-mark logo-dark">
            <!-- DARK MODE LOGO: duplicate the SVG above but change ONLY the first path fill to #ffffff. -->
            <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 970.9 136">              <path d="M69.4,0A68.771,68.771,0,0,1,85.8,1.9a53.012,53.012,0,0,0-5.7.3c-1.2.2-2.5.3-3.7.5-31.3,4.8-55.5,30.8-57,62.7h0v3.4l.1,2.1A49.863,49.863,0,0,0,36.9,106h0l.5.5c.3.2.5.4.8.6a50.189,50.189,0,0,0,31.6,11,54.51,54.51,0,0,0,8.9-.8,45.423,45.423,0,0,0,35.8-37.9h0l.1-.6L56.8,79l17-16.8h60.4l.057.6c.165,1.82.273,3.737.543,5.9h0v.6a67.168,67.168,0,0,1-28.7,55.4h0l-.091.075a2.946,2.946,0,0,0-.309.225h0l-.3.2a62.589,62.589,0,0,1-24.6,9.9,63.507,63.507,0,0,1-10.7.9c-19,0-36.7-7-49.8-19.7A65.02,65.02,0,0,1,.9,78.7a.6.6,0,0,1-.1-.4,28.855,28.855,0,0,1-.4-2.9,3.751,3.751,0,0,1-.1-1A19.419,19.419,0,0,1,.1,72,16.2,16.2,0,0,1,0,69.8V68.6c0-1.1.1-2.2.1-3.2h0v-.7l.011-.59C.14,63.336.22,62.6.3,61.8h0v-.1c.1-1.2.2-2.3.4-3.5C5.8,25.2,34.6,0,69.4,0ZM330.3,44.1c19.3,0,34.8,11.4,41.5,30.5h0l1.7,5-68,25.3.2.4c5.3,10.2,15.7,16.1,28.5,16.1,9.4,0,18.8-4.5,26.5-12.5h0l.4-.5,10.8,10.7-.7.7c-10.7,10.8-22.9,15.9-38.3,15.9-25.7,0-46.9-18.9-48.2-43a47.263,47.263,0,0,1,12.9-35A44.591,44.591,0,0,1,330.3,44.1Zm-95,0c19.3,0,34.8,11.4,41.5,30.5h0l1.7,5-68,25.3.2.4c5.3,10.2,15.7,16.1,28.5,16.1,9.4,0,18.9-4.5,26.5-12.5h0l.4-.5,10.8,10.7-.7.7c-10.7,10.8-22.9,15.9-38.3,15.9-25.7,0-46.9-18.9-48.2-43a47.263,47.263,0,0,1,12.9-35A44.591,44.591,0,0,1,235.3,44.1Zm631.5,0c19.3,0,34.8,11.4,41.5,30.5h0l1.6,4.9-68,25.3.2.4c5.3,10.2,15.7,16.1,28.5,16.1,9.4,0,18.8-4.4,26.6-12.4h0l.4-.5,10.8,10.7-.7.7c-10.7,10.8-22.9,15.9-38.3,15.9-25.7,0-46.9-18.9-48.2-43a47.263,47.263,0,0,1,12.9-35A44.591,44.591,0,0,1,866.8,44.1Zm-209.4,1a45,45,0,0,1,33.1,14.1h0l.7.8V48.4h16.7v83.1h-16V119.2l-.7.8a45.387,45.387,0,0,1-33.8,14.6c-24.5,0-43.6-19.6-43.6-44.6C613.8,65.2,633.4,45.1,657.4,45.1Zm154-43.8V131.4h-16V119.3l-.7.8c-8.3,9.2-20.6,14.5-33.8,14.5-24.5,0-43.6-19.6-43.6-44.6,0-24.8,19.6-44.9,43.6-44.9A44.837,44.837,0,0,1,794,59.2h0l.7.8V7.5ZM493.7,45.6a47.659,47.659,0,0,1,18.4,4.1,22.558,22.558,0,0,1,6.7,4.5h0l.7.7-9.7,9.4-.6-.3a31.233,31.233,0,0,0-14.3-4.1c-6.8,0-11.6,3.2-11.6,7.8,0,4.1,4.1,7,14.1,13.2,2.7,1.7,5.1,3.4,7.3,4.9,13,9.2,17.2,14.8,17.2,23,0,14.9-12.2,25-30.3,25.1-8.7,0-18.4-2.9-27.3-8.1h0l-1.1-.6,10.7-10.5.6.3c6.4,3.2,10.8,4.5,15.1,4.5,10.8-.3,14.7-5.2,14.7-9.4,0-2.4-1.4-5.8-11.2-12.6-1.7-1.2-3.5-2.4-5.5-3.6C469.8,82.7,465.9,78,465.9,67.5a20.452,20.452,0,0,1,6.3-14.4c3.5-3.4,10-7.5,21.2-7.5h.3Zm449,0a47.659,47.659,0,0,1,18.4,4.1,20.806,20.806,0,0,1,6.7,4.5h0l.7.7-8.9,8.7v1.2l-1.5-.8a31.232,31.232,0,0,0-14.3-4.1c-6.8,0-11.6,3.2-11.6,7.8,0,4.1,4.1,7,14.1,13.2,2.6,1.7,5,3.3,7.3,4.9,13,9.2,17.2,14.8,17.3,23,0,14.9-12.2,25-30.3,25.1-8.7,0-18.4-2.9-27.3-8.1h0l-1.1-.6,10.7-10.5.6.3c6.4,3.2,10.8,4.5,15.1,4.5,10.8-.3,14.7-5.2,14.7-9.4,0-2.4-1.4-5.8-11.2-12.6-1.7-1.2-3.5-2.3-5.5-3.6C918.8,82.7,914.9,78,914.9,67.5a20.452,20.452,0,0,1,6.3-14.4c3.5-3.4,10-7.5,21.2-7.5h.3Zm-517,.5C444.4,46.1,456,57.9,456,77h0v54.4H439.3v-48c0-7.8-2.5-21-19.7-21-8.2,0-20.3,6.2-20.3,19.6h0v49.4H382.6V48.3h16.1v7.6l.7-.7C407,47.7,417.9,46.1,425.7,46.1ZM547.2,1.3V55.9l.7-.7c7.6-7.5,18.5-9.1,26.3-9.1,18.8,0,30.5,11.8,30.5,30.9h0v54.4H588v-48c0-7.8-2.6-21-19.9-21-8.2,0-20.3,6.2-20.3,19.6h0v49.4H531.1V7.3ZM187.4,48.1V63.7c-16.1.2-25.7,11.3-25.7,22h0v45.6H145V48.2h16.1V61.9l.7-1.1c5.1-6.5,11.7-12.6,25.6-12.7ZM660.2,60.8a28.577,28.577,0,0,0-28.8,28.9c0,16.3,12.6,29.1,28.8,29.1a29,29,0,1,0,0-58Zm103.6,0A28.577,28.577,0,0,0,735,89.7c0,16.3,12.6,29.1,28.8,29.1a29,29,0,1,0,0-58ZM330.5,58.4a26.761,26.761,0,0,0-19.3,8.4c-6,6.2-9.1,14.9-8.9,24.5h0v.6l50.8-19.2.4-.2-.2-.4C348.3,63.1,340.4,58.4,330.5,58.4Zm-95,0a26.761,26.761,0,0,0-19.3,8.4c-6,6.2-9.1,14.9-8.9,24.5h0v.6l50.8-19.2.4-.2-.2-.4C253.3,63.1,245.4,58.4,235.5,58.4Zm631.5,0a26.761,26.761,0,0,0-19.3,8.4c-6,6.2-9.1,14.9-8.9,24.5h0v.6l50.8-19.2.4-.2-.2-.4C884.8,63.1,876.9,58.4,867,58.4Z" fill="#ffffff"></path>              <path d="M99.2,11.2A61.036,61.036,0,0,0,81.1,8.5,60.415,60.415,0,0,0,25.7,44.1l.9-1.5.2-.3c.3-.5.7-1,1-1.5.3-.4.5-.7.8-1.1l.5-.6h0a49.6,49.6,0,0,1,16.5-13c18.3-9.3,41.7-5.7,56,8.9l15.2-15.1a61.481,61.481,0,0,0-17.6-8.7" fill="#85c441"></path>            </svg>
          </div>
        </div>
        <h1>UTM Tracking Link Builder</h1>
      </div>
      <button
        id="themeToggle"
        type="button"
        class="theme-toggle"
        aria-label="Toggle light and dark mode"
      >
        <span class="theme-toggle-thumb">
          <span class="theme-toggle-icon">ðŸŒ™</span>
        </span>
      </button>
    </header>

    <div class="card">
      <div class="section-title">Campaign Parameters</div>
      <form id="utm-form" novalidate>
        <div class="form-group" style="grid-column: 1 / -1;">
          <label for="base-url">Base URL <span aria-hidden="true" style="color:#c62828;">*</span>
            <span class="info" tabindex="0" aria-label="Landing page before UTM params, such as a product or pricing page.">
              â“˜
              <span class="tooltip">Landing page before UTM params, e.g. product or pricing page.</span>
            </span>
          </label>
          <input type="text" id="base-url" placeholder="https://www.greenshades.com/pricing" required aria-describedby="base-url-error">
          <div id="base-url-error" class="error-text" role="alert" aria-live="polite"></div>
        </div>

        <div class="form-group">
          <label for="campaign-name">Campaign Name (utm_campaign) <span aria-hidden="true" style="color:#c62828;">*</span>
            <span class="info" tabindex="0" aria-label="Marketing initiative such as q3_product_launch or year_end_promo.">
              â“˜
              <span class="tooltip">Marketing initiative, e.g. q3_product_launch, year_end_promo, open_enrollment_push.</span>
            </span>
          </label>
          <input type="text" id="campaign-name" placeholder="q3_product_launch" required>
          <div class="helper-text">Ex: q3_product_launch, year_end_promo</div>
        </div>

        <div class="form-group">
          <label for="source-select">Source (utm_source) <span aria-hidden="true" style="color:#c62828;">*</span>
            <span class="info" tabindex="0" aria-label="Where the traffic comes from such as google, linkedin, newsletter, or partner sites.">
              â“˜
              <span class="tooltip">Where traffic comes from (platform/site), e.g. google, linkedin, newsletter, partner.</span>
            </span>
          </label>
          <select id="source-select" required>
            <option value="">Select source</option>
            <option value="google">google</option>
            <option value="linkedin">linkedin</option>
            <option value="facebook">facebook</option>
            <option value="email">email</option>
            <option value="newsletter">newsletter</option>
            <option value="webinar">webinar</option>
            <option value="trade_show">trade_show</option>
            <option value="referral">referral</option>
            <option value="custom">Custom</option>
          </select>
          <input type="text" id="custom-source" class="inline-input" placeholder="Enter custom source">
        </div>

        <div class="form-group">
          <label for="medium-select">Medium (utm_medium) <span aria-hidden="true" style="color:#c62828;">*</span>
            <span class="info" tabindex="0" aria-label="How the traffic was delivered such as cpc, paid_social, email, or display.">
              â“˜
              <span class="tooltip">How traffic was delivered (channel type), e.g. cpc, paid_social, email, display.</span>
            </span>
          </label>
          <select id="medium-select" required>
            <option value="">Select medium</option>
            <option value="cpc">cpc</option>
            <option value="paid_social">paid_social</option>
            <option value="email">email</option>
            <option value="organic_social">organic_social</option>
            <option value="display">display</option>
            <option value="partner">partner</option>
            <option value="other">other</option>
          </select>
          <input type="text" id="custom-medium" class="inline-input" placeholder="Enter custom medium">
        </div>

        <div class="form-group">
          <label for="content">Content (utm_content)
            <span class="info" tabindex="0" aria-label="Differentiates creatives or placements such as header_banner_a or cta_button_variant_b.">
              â“˜
              <span class="tooltip">Differentiates creatives/placements, e.g. header_banner_a, cta_button_variant_b.</span>
            </span>
          </label>
          <input type="text" id="content" placeholder="variant_a">
          <div class="helper-text">Used to differentiate ad variations or placements.</div>
        </div>

        <div class="form-group">
          <label for="term">Term (utm_term)
            <span class="info" tabindex="0" aria-label="Usually a paid search keyword or targeting term such as payroll_software or hris_platform.">
              â“˜
              <span class="tooltip">Typically paid search keyword or targeting term, e.g. payroll_software, hris_platform.</span>
            </span>
          </label>
          <input type="text" id="term" placeholder="keyword">
          <div class="helper-text">Optional. Often used for paid search keywords.</div>
        </div>

        <div class="form-group">
          <label for="asset">Asset Name / Notes (internal)</label>
          <input type="text" id="asset" placeholder="Hero banner A/B test" aria-describedby="asset-helper">
          <div class="helper-text" id="asset-helper">Not included in URL. Shown in history for context.</div>
        </div>

        <div class="actions">
          <button id="generate-btn" class="btn" type="button" disabled>Generate UTM URL</button>
          <div class="muted">Required fields: Base URL, Campaign, Source, Medium.</div>
        </div>
      </form>

      <div class="section-title">Output</div>
      <div class="output-section">
        <div class="output-row">
          <div>
            <h3>UTM Query String</h3>
            <div id="query-output" class="output-box" aria-live="polite">?utm_source=&utm_medium=&utm_campaign=</div>
          </div>
          <button id="copy-query" class="btn" type="button">Copy Query String</button>
          <span id="query-status" class="muted" aria-live="polite"></span>
        </div>

        <div class="output-row">
          <div>
            <h3>Full URL</h3>
            <div id="full-output" class="output-box" aria-live="polite">https://www.greenshades.com/pricing?utm_source=&utm_medium=&utm_campaign=</div>
          </div>
          <button id="copy-full" class="btn" type="button">Copy Full URL</button>
          <span id="full-status" class="muted" aria-live="polite"></span>
        </div>
      </div>

      <div class="section-title">Recently Generated Links</div>
      <div class="history-wrapper">
        <table aria-label="Recently generated UTM links" class="history-table" id="history-table">
          <thead>
            <tr>
              <th scope="col">Time</th>
              <th scope="col">Full URL</th>
              <th scope="col" class="visually-hidden">Copy</th>
            </tr>
          </thead>
          <tbody id="history-body">
            <tr><td class="muted" colspan="3">No links generated yet.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">Copied!</div>

  <script>
    const baseUrlInput = document.getElementById('base-url');
    const campaignInput = document.getElementById('campaign-name');
    const sourceSelect = document.getElementById('source-select');
    const customSourceInput = document.getElementById('custom-source');
    const mediumSelect = document.getElementById('medium-select');
    const customMediumInput = document.getElementById('custom-medium');
    const contentInput = document.getElementById('content');
    const termInput = document.getElementById('term');
    const assetInput = document.getElementById('asset');
    const generateBtn = document.getElementById('generate-btn');
    const queryOutput = document.getElementById('query-output');
    const fullOutput = document.getElementById('full-output');
    const queryStatus = document.getElementById('query-status');
    const fullStatus = document.getElementById('full-status');
    const baseUrlError = document.getElementById('base-url-error');
    const historyBody = document.getElementById('history-body');
    const toast = document.getElementById('toast');
    const themeToggle = document.getElementById('themeToggle');
    const themeToggleIcon = document.querySelector('.theme-toggle-icon');
    const bodyEl = document.body;

    const SUPABASE_URL = 'https://vykrwabiujhlwcbskoel.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_WuDHZx2YzTsYPnsSyg6uEQ_lHG5ShEH';
    const SUPABASE_TABLE = 'utm_links';
    const SUPABASE_ENABLED = true;

    let toastTimeout;

    const THEME_KEY = 'gs-utm-theme';

    function setToggleIcon(theme) {
      if (!themeToggleIcon) return;
      themeToggleIcon.textContent = theme === 'light' ? 'â˜€ï¸' : 'ðŸŒ™';
    }

    function applyTheme(theme) {
      const nextTheme = theme === 'light' ? 'light' : 'dark';
      bodyEl.dataset.theme = nextTheme;
      setToggleIcon(nextTheme);
      localStorage.setItem(THEME_KEY, nextTheme);
    }

    function initTheme() {
      const stored = localStorage.getItem(THEME_KEY);
      applyTheme(stored || 'dark');
    }

    function normalizeValue(value) {
      if (!value) return '';
      const trimmed = value.trim().toLowerCase().replace(/\s+/g, '_');
      return encodeURIComponent(trimmed);
    }

    function isValidUrl(value) {
      if (!value) return false;
      const trimmed = value.trim();
      const pattern = /^https?:\/\//i;
      if (!pattern.test(trimmed)) return false;
      try {
        new URL(trimmed);
        return true;
      } catch {
        return false;
      }
    }

    function currentValues() {
      const sourceValue = sourceSelect.value === 'custom' ? customSourceInput.value : sourceSelect.value;
      const mediumValue = mediumSelect.value === 'other' ? customMediumInput.value : mediumSelect.value;

      return {
        baseUrl: baseUrlInput.value.trim(),
        campaign: campaignInput.value,
        source: sourceValue,
        medium: mediumValue,
        content: contentInput.value,
        term: termInput.value,
        asset: assetInput.value
      };
    }

    function buildQuery(params) {
      const queryParts = [];
      if (params.source) queryParts.push(['utm_source', normalizeValue(params.source)]);
      if (params.medium) queryParts.push(['utm_medium', normalizeValue(params.medium)]);
      if (params.campaign) queryParts.push(['utm_campaign', normalizeValue(params.campaign)]);
      if (params.content) queryParts.push(['utm_content', normalizeValue(params.content)]);
      if (params.term) queryParts.push(['utm_term', normalizeValue(params.term)]);

      if (!queryParts.length) return '';

      const searchParams = new URLSearchParams();
      queryParts.forEach(([key, val]) => {
        if (val) searchParams.append(key, val);
      });
      const qs = searchParams.toString();
      return qs ? `?${qs}` : '';
    }

    function buildFullUrl(base, queryString) {
      if (!base) return '';
      const hasQuery = base.includes('?');
      if (!queryString) return base;
      if (hasQuery) {
        return base.endsWith('&') || base.endsWith('?') ? `${base}${queryString.replace(/^\?/, '')}` : `${base}&${queryString.replace(/^\?/, '')}`;
      }
      return `${base}${queryString}`;
    }

    function updateInlineVisibility() {
      customSourceInput.classList.toggle('active', sourceSelect.value === 'custom');
      customMediumInput.classList.toggle('active', mediumSelect.value === 'other');
    }

    function truncateMiddle(str, max = 60) {
      if (str.length <= max) return str;
      const start = str.slice(0, Math.floor(max / 2) - 2);
      const end = str.slice(-Math.floor(max / 2) + 1);
      return `${start}...${end}`;
    }

    function validateBase() {
      const value = baseUrlInput.value.trim();
      if (!value) {
        baseUrlError.textContent = '';
        return false;
      }
      const valid = isValidUrl(value);
      baseUrlError.textContent = valid ? '' : 'Please enter a valid URL that starts with http or https.';
      return valid;
    }

    function requiredFieldsFilled() {
      const { baseUrl, campaign, source, medium } = currentValues();
      return baseUrl && campaign.trim() && source.trim() && medium.trim();
    }

    function updateOutputs() {
      const params = currentValues();
      const baseValid = validateBase();
      const ready = baseValid && requiredFieldsFilled();
      generateBtn.disabled = !ready;

      if (!ready) {
        queryOutput.textContent = '?utm_source=&utm_medium=&utm_campaign=';
        fullOutput.textContent = params.baseUrl || 'https://www.greenshades.com/pricing?utm_source=&utm_medium=&utm_campaign=';
        return;
      }

      const query = buildQuery(params);
      const full = buildFullUrl(params.baseUrl, query);
      queryOutput.textContent = query || '?';
      fullOutput.textContent = full;
    }

    function showToast(message) {
      toast.textContent = message;
      toast.classList.add('show');
      clearTimeout(toastTimeout);
      toastTimeout = setTimeout(() => toast.classList.remove('show'), 2000);
    }

    async function copyToClipboard(text, statusElement) {
      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(text);
        } else {
          const tempInput = document.createElement('textarea');
          tempInput.value = text;
          document.body.appendChild(tempInput);
          tempInput.select();
          document.execCommand('copy');
          document.body.removeChild(tempInput);
        }
        statusElement.textContent = 'Copied!';
        showToast('Copied!');
        setTimeout(() => statusElement.textContent = '', 1500);
      } catch (err) {
        statusElement.textContent = 'Copy failed';
        setTimeout(() => statusElement.textContent = '', 2000);
      }
    }

    async function saveLinkToSupabase(record) {
      try {
        const res = await fetch(`${SUPABASE_URL}/rest/v1/${SUPABASE_TABLE}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            apikey: SUPABASE_KEY,
            Authorization: `Bearer ${SUPABASE_KEY}`,
            Prefer: 'return=representation'
          },
          body: JSON.stringify(record)
        });

        if (!res.ok) {
          console.error('Failed to save to Supabase', await res.text());
          return null;
        }

        const data = await res.json();
        return data[0] || null;
      } catch (err) {
        console.error('Error saving to Supabase', err);
        return null;
      }
    }

    async function loadRecentLinksFromSupabase() {
      try {
        const res = await fetch(
          `${SUPABASE_URL}/rest/v1/${SUPABASE_TABLE}?select=*&order=created_at.desc&limit=50`,
          {
            headers: {
              apikey: SUPABASE_KEY,
              Authorization: `Bearer ${SUPABASE_KEY}`
            }
          }
        );

        if (!res.ok) {
          console.error('Failed to fetch from Supabase', await res.text());
          return [];
        }

        return await res.json();
      } catch (err) {
        console.error('Error fetching history', err);
        return [];
      }
    }

    function addHistoryRowFromRecord(row, appendToBottom = false) {
      if (!row) return;
      if (historyBody.children.length === 1 && historyBody.querySelector('td')?.classList.contains('muted')) {
        historyBody.innerHTML = '';
      }

      const recordDate = row.created_at ? new Date(row.created_at) : new Date();
      const rowEl = document.createElement('tr');

      const timeCell = document.createElement('td');
      timeCell.textContent = recordDate.toLocaleString();
      rowEl.appendChild(timeCell);

      const urlCell = document.createElement('td');
      urlCell.title = row.full_url || '';
      urlCell.classList.add('history-url');
      urlCell.textContent = row.full_url || '';
      rowEl.appendChild(urlCell);

      const copyCell = document.createElement('td');
      const copyBtn = document.createElement('button');
      copyBtn.type = 'button';
      copyBtn.className = 'table-copy-btn';
      copyBtn.textContent = 'Copy';
      copyBtn.addEventListener('click', async () => {
        const textToCopy = row.full_url || '';
        const originalText = copyBtn.textContent;
        try {
          if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(textToCopy);
          } else {
            const tempInput = document.createElement('textarea');
            tempInput.value = textToCopy;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
          }
          copyBtn.textContent = 'Copied!';
          copyBtn.disabled = true;
          setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.disabled = false;
          }, 1200);
        } catch (err) {
          console.error('Copy failed', err);
        }
      });
      copyCell.appendChild(copyBtn);
      rowEl.appendChild(copyCell);

      if (appendToBottom) {
        historyBody.appendChild(rowEl);
      } else {
        historyBody.insertBefore(rowEl, historyBody.firstChild);
      }
    }

    async function handleGenerate() {
      const params = currentValues();
      const baseValid = validateBase();
      if (!(baseValid && requiredFieldsFilled())) return;

      const query = buildQuery(params);
      const full = buildFullUrl(params.baseUrl, query);
      queryOutput.textContent = query || '?';
      fullOutput.textContent = full;

      const normalizedSource = normalizeValue(params.source);
      const normalizedMedium = normalizeValue(params.medium);
      const normalizedCampaign = normalizeValue(params.campaign);
      const normalizedContent = normalizeValue(params.content);
      const normalizedTerm = normalizeValue(params.term);
      const assetNotes = params.asset.trim();

      const record = {
        base_url: params.baseUrl,
        full_url: full,
        utm_source: normalizedSource,
        utm_medium: normalizedMedium,
        utm_campaign: normalizedCampaign,
        utm_content: normalizedContent || null,
        utm_term: normalizedTerm || null,
        asset_notes: assetNotes || null
      };

      const saved = SUPABASE_ENABLED ? await saveLinkToSupabase(record) : null;
      const finalRecord = saved || { ...record, created_at: new Date().toISOString() };
      addHistoryRowFromRecord(finalRecord);
    }

    const inputs = [baseUrlInput, campaignInput, sourceSelect, customSourceInput, mediumSelect, customMediumInput, contentInput, termInput, assetInput];
    inputs.forEach(input => input.addEventListener('input', () => {
      updateInlineVisibility();
      updateOutputs();
    }));

    sourceSelect.addEventListener('change', () => {
      if (sourceSelect.value !== 'custom') customSourceInput.value = '';
      updateInlineVisibility();
      updateOutputs();
    });

    mediumSelect.addEventListener('change', () => {
      if (mediumSelect.value !== 'other') customMediumInput.value = '';
      updateInlineVisibility();
      updateOutputs();
    });

    generateBtn.addEventListener('click', handleGenerate);

    themeToggle.addEventListener('click', () => {
      const nextTheme = bodyEl.dataset.theme === 'dark' ? 'light' : 'dark';
      applyTheme(nextTheme);
    });

    document.getElementById('copy-full').addEventListener('click', () => {
      copyToClipboard(fullOutput.textContent, fullStatus);
    });

    document.getElementById('copy-query').addEventListener('click', () => {
      copyToClipboard(queryOutput.textContent, queryStatus);
    });

    async function loadInitialHistory() {
      if (!SUPABASE_ENABLED) return;
      const records = await loadRecentLinksFromSupabase();
      if (!records.length) {
        historyBody.innerHTML = '<tr><td class="muted" colspan="3">No links generated yet.</td></tr>';
        return;
      }
      historyBody.innerHTML = '';
      records.forEach(record => addHistoryRowFromRecord(record, true));
    }

    initTheme();
    updateInlineVisibility();
    updateOutputs();
    loadInitialHistory();
  </script>
</body>
</html>
